{"version":3,"sources":["search.ts"],"names":["KodiPassion","KodiPassion.UI","KodiPassion.UI.Pages","KodiPassion.UI.Pages.SearchPage","KodiPassion.UI.Pages.SearchPage.constructor","KodiPassion.UI.Pages.SearchPage.init","KodiPassion.UI.Pages.SearchPage.processed","KodiPassion.UI.Pages.SearchPage.ready","KodiPassion.UI.Pages.SearchPage.search","KodiPassion.UI.Pages.SearchPage.renderSearchResult","KodiPassion.UI.Pages.SearchPage.resolveItem","KodiPassion.UI.Pages.SearchPage.unload"],"mappings":"AAAA,IAAO,WAAW,CAiGjB;AAjGD,WAAO,WAAW;IAACA,IAAAA,EAAEA,CAiGpBA;IAjGkBA,WAAAA,EAAEA;QAACC,IAAAA,KAAKA,CAiG1BA;QAjGqBA,WAAAA,KAAKA,EAACA,CAACA;YACzBC,YAAYA,CAACA,MAAMA,CAACA,UAAUA,GAAGA,wDAAwDA,CAACA;YAE1FA;gBAAAC;gBA2FAC,CAACA;gBAjFGD,yBAAIA,GAAJA,UAAKA,OAAOA,EAAEA,OAAOA;oBACjBE,IAAIA,CAACA,KAAKA,GAAGA,IAAIA,YAAYA,CAACA,MAAMA,CAACA,UAAUA,CAACA;wBAC5CA,MAAMA,EAAEA,EAAEA,SAASA,EAAEA,IAAIA,EAAEA;wBAC3BA,OAAOA,EAAEA,EAAEA,SAASA,EAAEA,IAAIA,EAAEA;wBAC5BA,KAAKA,EAAEA,EAAEA,SAASA,EAAEA,IAAIA,EAAEA;wBAC1BA,OAAOA,EAAEA,EAAEA,SAASA,EAAEA,IAAIA,EAAEA;qBAC/BA,CAACA,CAACA;oBACHA,IAAIA,CAACA,UAAUA,GAAGA,IAAIA,CAACA,KAAKA,CAACA,IAAIA,EAAEA,CAACA;oBACpCA,IAAIA,CAACA,IAAIA,GAAGA,IAAIA,CAACA,IAAIA,CAACA,YAAYA,EAAEA,CAACA;gBACzCA,CAACA;gBAEDF,8BAASA,GAATA,UAAUA,OAAOA,EAAEA,OAAOA;oBAA1BG,iBAKCA;oBAJGA,CAACA,CAACA,IAAIA,CAACA,SAASA,CAACA,CAACA,mBAAmBA,CAACA,YAAYA,CAACA,CAACA;oBACpDA,IAAIA,CAACA,YAAYA,CAACA,QAAQA,CAACA,IAAIA,CAACA,SAASA,EAAEA,OAAOA,EAAEA;wBAChDA,KAAIA,CAACA,MAAMA,EAAEA,CAACA;oBAClBA,CAACA,CAACA,CAACA;gBACPA,CAACA;gBAEDH,0BAAKA,GAALA;oBAAAI,iBAICA;oBAHGA,UAAUA,CAACA;wBACPA,KAAIA,CAACA,SAASA,CAACA,KAAKA,EAAEA,CAACA;oBAC3BA,CAACA,EAAEA,GAAGA,CAACA,CAACA;gBACZA,CAACA;gBAEDJ,2BAAMA,GAANA;oBAAAK,iBAqBCA;oBApBGA,EAAEA,CAACA,CAACA,IAAIA,CAACA,aAAaA,CAACA,CAACA,CAACA;wBACrBA,IAAIA,CAACA,aAAaA,CAACA,MAAMA,EAAEA,CAACA;oBAChCA,CAACA;oBAEDA,IAAIA,UAAUA,GAAGA,IAAIA,CAACA,SAASA,CAACA,KAAKA,CAACA;oBACtCA,EAAEA,CAACA,CAACA,UAAUA,IAAIA,UAAUA,CAACA,MAAMA,GAAGA,CAACA,CAACA,CAACA,CAACA;wBACtCA,IAAIA,CAACA,aAAaA,GAAGA,IAAIA,CAACA,UAAUA,CAACA,IAAIA,CAACA;4BACtCA,MAAMA,CAACA,KAAIA,CAACA,KAAKA,CAACA,MAAMA,CAACA,UAAUA,CAACA,CAACA,IAAIA,CAACA,UAACA,YAAYA;gCACnDA,EAAEA,CAACA,CAACA,YAAYA,IAAIA,YAAYA,CAACA,UAAUA,CAACA,CAACA,CAACA;oCAC1CA,MAAMA,CAACA,KAAIA,CAACA,kBAAkBA,CAACA,YAAYA,CAACA,UAAUA,CAACA,KAAKA,CAACA,CAACA,EAACA,EAAEA,CAACA,CAACA,CAACA;gCACxEA,CAACA;gCAACA,IAAIA,CAACA,CAACA;oCACJA,KAAIA,CAACA,WAAWA,CAACA,SAASA,GAAGA,EAAEA,CAACA;gCACpCA,CAACA;4BACLA,CAACA,EAAEA,UAACA,GAAGA;gCACHA,IAAIA,CAACA,GAAGA,GAAGA,CAACA;4BAChBA,CAACA,CAACA,CAACA;wBACPA,CAACA,CAACA,CAACA;oBACPA,CAACA;oBAACA,IAAIA,CAACA,CAACA;wBACJA,IAAIA,CAACA,WAAWA,CAACA,SAASA,GAAGA,EAAEA,CAACA;oBACpCA,CAACA;gBACLA,CAACA;gBAEDL,uCAAkBA,GAAlBA,UAAmBA,YAAYA;oBAA/BM,iBAcCA;oBAbGA,IAAIA,CAACA,WAAWA,CAACA,SAASA,GAAGA,EAAEA,CAACA;oBAChCA,MAAMA,CAACA,YAAYA,CAACA,OAAOA,CAACA,SAASA,CAACA,YAAYA,EAAEA,UAACA,CAACA;wBAClDA,CAACA,CAACA,KAAKA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","file":"KodiPassion/pages/search/search.js","sourcesContent":["module KodiPassion.UI.Pages {\r\n    WinJSContrib.Search.workerPath = \"/scripts/winjscontrib/js/winjscontrib.search.worker.js\";\r\n\r\n    export class SearchPage {\r\n        public static url = \"/pages/search/search.html\";\r\n        eventTracker: WinJSContrib.UI.EventTracker;\r\n        txtsearch: HTMLInputElement;\r\n        resultItems: HTMLElement;\r\n        index: WinJSContrib.Search.IndexGroup;\r\n        indexReady: WinJS.Promise<any>;\r\n        currentSearch: WinJS.Promise<any>;\r\n        data: WinJS.Promise<Kodi.Data.IMediaLibrary>;\r\n\r\n        init(element, options) {\r\n            this.index = new WinJSContrib.Search.IndexGroup({\r\n                movies: { useworker: true },\r\n                tvshows: { useworker: true },\r\n                music: { useworker: true },\r\n                artists: { useworker: true },                \r\n            });\r\n            this.indexReady = this.index.load();\r\n            this.data = Kodi.Data.loadRootData();\r\n        }\r\n\r\n        processed(element, options) {\r\n            $(this.txtsearch).pressEnterDefaultTo(\"#btnSearch\");\r\n            this.eventTracker.addEvent(this.txtsearch, \"input\", () => {\r\n                this.search();\r\n            });\r\n        }\r\n\r\n        ready() {\r\n            setTimeout(() => {\r\n                this.txtsearch.focus();\r\n            }, 300);\r\n        }\r\n\r\n        search() {\r\n            if (this.currentSearch) {\r\n                this.currentSearch.cancel();\r\n            }\r\n\r\n            var searchterm = this.txtsearch.value;\r\n            if (searchterm && searchterm.length > 2) {\r\n                this.currentSearch = this.indexReady.then(() => {\r\n                    return this.index.search(searchterm).then((searchresult) => {\r\n                        if (searchresult && searchresult.allResults) {\r\n                            return this.renderSearchResult(searchresult.allResults.slice(0,20));\r\n                        } else {\r\n                            this.resultItems.innerHTML = \"\";\r\n                        }\r\n                    }, (err) => {\r\n                        var e = err;\r\n                    });\r\n                });\r\n            } else {\r\n                this.resultItems.innerHTML = \"\";\r\n            }\r\n        }\r\n\r\n        renderSearchResult(searchResult) {\r\n            this.resultItems.innerHTML = \"\";\r\n            return WinJSContrib.Promise.waterfall(searchResult, (s) => {\r\n                s.label = s.item.label;\r\n                s.thumbnail = s.item.thumbnail;\r\n                return KodiPassion.Templates.search.render(s).then((rendered) => {\r\n                    this.resultItems.appendChild(rendered);\r\n                    WinJSContrib.UI.tap(rendered, () => {\r\n                        return this.data.then((data) => {\r\n                            return this.resolveItem(s, data);\r\n                        });\r\n                    });\r\n                });\r\n            });\r\n        }\r\n\r\n        resolveItem(searchitem, lib: Kodi.Data.IMediaLibrary) {\r\n            if (searchitem.searchItemType == \"music\") {\r\n                let item = <Kodi.API.Music.Album>searchitem.item;\r\n                WinJS.Navigation.navigate(\"/pages/albums/detail/albumsdetail.html\", { album: item, navigateStacked: true });\r\n            } else if (searchitem.searchItemType == \"artists\") {\r\n                WinJS.Navigation.navigate(\"/pages/albums/list/albumslist.html\", { artist: searchitem.item.label });\r\n            } else if (searchitem.searchItemType == \"movies\") {\r\n                let item = <Kodi.API.Videos.Movies.Movie>searchitem.item; \r\n                WinJS.Navigation.navigate(\"/pages/movies/detail/moviesdetail.html\", { movie: item, navigateStacked: true });\r\n            } else if (searchitem.searchItemType == \"tvshows\") {\r\n                let item = <Kodi.API.Videos.TVShows.TVShow>searchitem.item;\r\n                WinJS.Navigation.navigate(\"/pages/tvshows/seriedetail/tvshowsseriedetail.html\", { tvshow: item, navigateStacked: true }); \r\n            }\r\n        }\r\n\r\n        unload() {\r\n            this.index.dispose();\r\n        }\r\n    }\r\n\r\n    WinJS.UI.Pages.define(SearchPage.url, SearchPage);\r\n}"],"sourceRoot":" "}