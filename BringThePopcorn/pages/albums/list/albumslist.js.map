{"version":3,"sources":["albumslist.ts"],"names":["BtPo","BtPo.UI","BtPo.UI.Pages","BtPo.UI.Pages.AlbumsListPage","BtPo.UI.Pages.AlbumsListPage.constructor","BtPo.UI.Pages.AlbumsListPage.init","BtPo.UI.Pages.AlbumsListPage.saveViewSetting","BtPo.UI.Pages.AlbumsListPage.processed","BtPo.UI.Pages.AlbumsListPage.ready","BtPo.UI.Pages.AlbumsListPage.pickGenre","BtPo.UI.Pages.AlbumsListPage.updateLayout","BtPo.UI.Pages.AlbumsListPage.calcItemsSizes","BtPo.UI.Pages.AlbumsListPage.showMenu","BtPo.UI.Pages.AlbumsListPage.hideMenu"],"mappings":"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","file":"BringThePopcorn/pages/albums/list/albumslist.js","sourcesContent":["module BtPo.UI.Pages {\r\n    interface IAlbumViewSetting {\r\n        group: string;\r\n        view: string;\r\n    }\r\n\r\n    export class AlbumsListPage {\r\n        public static url = \"/pages/albums/list/albumslist.html\";\r\n\r\n        itemsPromise: WinJS.Promise<any>;\r\n        selectedGenre: string;\r\n        semanticzoom: any;\r\n        element: HTMLElement;\r\n        genretitle: HTMLElement;\r\n        menu: HTMLElement;\r\n        menuGroups: HTMLElement;\r\n        menuViews: HTMLElement;\r\n        pagetitle: HTMLElement;\r\n        itemsStyle: HTMLStyleElement;\r\n        albums: Kodi.API.Music.Album[];\r\n        genres: Kodi.API.Genre[];\r\n        viewSetting: IAlbumViewSetting;        \r\n\r\n        static albumsGroups = {\r\n            \"none\": {\r\n                name: \"no grouping\",\r\n                groupKind: null,\r\n                groupField: null\r\n            },\r\n            \"alphabetic\": {\r\n                name: \"alphabetic\",\r\n                groupKind: WinJSContrib.UI.DataSources.Grouping.alphabetic,\r\n                groupField: 'label'\r\n            },\r\n            \"artist\": {\r\n                name: \"artist\",\r\n                groupKind: WinJSContrib.UI.DataSources.Grouping.alphabetic,\r\n                groupField: 'artist'\r\n            },\r\n            \"year\": {\r\n                name: \"year\",\r\n                groupKind: WinJSContrib.UI.DataSources.Grouping.byField,\r\n                groupField: 'year'\r\n            }\r\n        }\r\n\r\n        static albumsViews = {\r\n            \"list\": {\r\n                name: \"list\",\r\n                template: BtPo.Templates.album\r\n            }\r\n        }\r\n\r\n        init(element, options) {\r\n            var page = this;\r\n            element.classList.add(\"listpage\");\r\n            element.classList.add(\"page-albumslist\");            \r\n            page.itemsPromise = Kodi.Data.loadRootData();\r\n            this.viewSetting = {\r\n                group: \"none\",\r\n                view: \"list\"\r\n            }\r\n            var s = localStorage[\"albumsListView\"];\r\n            if (s) {\r\n                this.viewSetting = <IAlbumViewSetting>JSON.parse(s);\r\n            }\r\n        }\r\n\r\n        saveViewSetting() {\r\n            localStorage[\"albumsListView\"] = JSON.stringify(this.viewSetting);\r\n        }\r\n\r\n        processed(element, options) {\r\n            var page = this;\r\n            if (options && options.genre) {\r\n                page.selectedGenre = options.genre;\r\n                page.genretitle.innerText = page.selectedGenre;\r\n            }\r\n\r\n            page.itemsStyle = <HTMLStyleElement>document.createElement(\"STYLE\");\r\n            page.element.appendChild(page.itemsStyle);\r\n\r\n            page.itemsPromise = page.itemsPromise.then((data: Kodi.Data.IMediaLibrary) => {\r\n                page.albums = data.music.albums;\r\n                page.genres = data.musicGenres.genres;\r\n                \r\n                BtPo.ListHelpers.renderMenu({\r\n                    views: AlbumsListPage.albumsViews,\r\n                    groups: AlbumsListPage.albumsGroups,\r\n                    root: page.element,\r\n                    viewsContainer: page.menuViews,\r\n                    groupsContainer: page.menuGroups,\r\n                    dsManager: page.semanticzoom,\r\n                    setting: page.viewSetting,\r\n                    defaultView: \"list\",\r\n                    defaultGroup: \"none\",\r\n                    saveSetting: () => {\r\n                        this.saveViewSetting();\r\n                    }\r\n                });\r\n\r\n                page.semanticzoom.dataManager.filter = (album: Kodi.API.Music.Album) => {\r\n                    if (!page.selectedGenre)\r\n                        return true;\r\n\r\n                    var hasgenre = album.allgenres.indexOf(page.selectedGenre) >= 0;\r\n                    return hasgenre;\r\n                }\r\n                if (options.artist) {\r\n                    page.pagetitle.innerText = options.artist;\r\n                    page.genretitle.style.display = \"none\";\r\n                    page.semanticzoom.dataManager.filters.push((a) => {\r\n                        return a.allartists.indexOf(options.artist) >= 0;\r\n                    });\r\n                }\r\n                page.semanticzoom.listview.layout = new WinJS.UI.GridLayout();\r\n                page.semanticzoom.listview.layout.orientation = \"vertical\";\r\n                page.semanticzoom.listview.oniteminvoked = (arg) => {\r\n                    arg.detail.itemPromise.then((item) => {\r\n                        WinJS.Navigation.navigate(\"/pages/albums/detail/albumsdetail.html\", { album: item.data, navigateStacked: true });\r\n                    });\r\n                }\r\n            });\r\n        }\r\n\r\n        ready() {\r\n            var page = this;\r\n            page.itemsPromise.then(() => {\r\n                page.calcItemsSizes();\r\n                page.semanticzoom.dataManager.items = page.albums;\r\n            });\r\n        }\r\n\r\n        pickGenre() {\r\n            var page = this;\r\n            BtPo.UI.GenrePicker.pick(page.genres).then(function (genre) {\r\n                if (genre) {\r\n                    if (genre === \"all\") {\r\n                        page.selectedGenre = null;\r\n                        page.genretitle.innerText = \"all\";\r\n                    } else {\r\n                        page.selectedGenre = genre.label;\r\n                        page.genretitle.innerText = page.selectedGenre;\r\n                    }\r\n                    page.semanticzoom.dataManager.refresh();\r\n                }\r\n            });\r\n        }\r\n\r\n        updateLayout(element) {\r\n            var page = this;\r\n            this.calcItemsSizes();\r\n            page.semanticzoom.listview.forceLayout();\r\n        }\r\n\r\n        calcItemsSizes() {\r\n            var page = this;\r\n            var w = page.element.clientWidth;\r\n            if (w) {\r\n                var nbitems = ((w / 500) << 0) + 1;\r\n                var posterW = ((w / nbitems) << 0) - 1 - 0.25;\r\n                page.itemsStyle.innerHTML = \".page-albumslist.view-list .album-item { width:\" + posterW + \"px; }\";\r\n            }\r\n        }\r\n\r\n        showMenu() {\r\n            this.menu.classList.add(\"visible\");\r\n        }\r\n\r\n        hideMenu() {\r\n            this.menu.classList.remove(\"visible\");\r\n        }\r\n    }\r\n\r\n    WinJS.UI.Pages.define(AlbumsListPage.url, AlbumsListPage);\r\n}"],"sourceRoot":" "}