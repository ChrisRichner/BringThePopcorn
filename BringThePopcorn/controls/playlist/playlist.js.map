{"version":3,"sources":["playlist.ts"],"names":["BtPo","BtPo.UI","BtPo.UI.PlayListControl","BtPo.UI.PlayListControl.constructor","BtPo.UI.PlayListControl.items","BtPo.UI.PlayListControl.refresh","BtPo.UI.PlayListControl.renderItems","BtPo.UI.PlayListControl.dispose"],"mappings":"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EA,KAAKA,CAACA,CAACA,IAAIA,CAACA;oCACxEA,KAAIA,CAACA,OAAOA,EAAEA,CAACA;gCACnBA,CAACA,CAACA,CAACA;4BACPA,CAACA,CAACA,CAACA;4BAEHA,YAAYA,CAACA,EAAEA,CAACA,GAAGA,CAACA,SAASA,EAAEA;gCAC3BA,MAAMA,CAACA,IAAIA,CAACA,GAAGA,CAACA,QAAQA,CAACA,QAAQA,CAACA,IAAIA,CAACA,UAAUA,CAACA,OAAOA,CAACA,UAAUA,EAAEA,KAAKA,CAACA,CAACA,IAAIA,CAACA;oCAC9EA,MAAMA,CAACA,YAAYA,CAACA,EAAEA,CAACA,sBAAsBA,CAACA,QAAQA,CAACA,CAACA,IAAIA,CAACA;wCACzDA,iBAAiBA;oCACrBA,CAACA,CAACA,CAACA;gCACPA,CAACA,CAACA,CAACA;4BACPA,CAACA,CAACA,CAACA;wBACPA,CAACA,CAACA,CAACA,CAACA;oBACRA,CAACA,CAACA,CAACA;oBAEHA,KAAKA,CAACA,OAAOA,CAACA,IAAIA,CAACA,CAACA,CAACA,CAACA,IAAIA,CAACA;wBACvBA,EAAEA,CAACA,CAACA,OAAOA,CAACA,CAACA,CAACA;4BACVA,KAAKA,CAACA,EAAEA,CAACA,SAASA,CAACA,SAASA,CAACA,IAAIA,CAACA,CAACA;wBACvCA,CAACA;wBACDA,kCAAkCA;wBAClCA,0CAA0CA;oBAC9CA,CAACA,CAACA,CAACA;gBACPA,CAACA;YACLA,CAACA;YAEDJ,iCAAOA,GAAPA;gBACIK,IAAIA,CAACA,YAAYA,CAACA,OAAOA,EAAEA,CAACA;YAChCA,CAACA;YACLL,sBAACA;QAADA,CAnHAD,AAmHCC,IAAAD;QAnHYA,kBAAeA,kBAmH3BA,CAAAA;QAEUA,WAAQA,GAAGA,KAAKA,CAACA,KAAKA,CAACA,GAAGA,CAACA,KAAKA,CAACA,SAASA,CAACA,0BAA0BA,CAACA,eAAeA,CAACA,EAAEA,KAAKA,CAACA,SAASA,CAACA,UAAUA,EACzHA,KAAKA,CAACA,SAASA,CAACA,qBAAqBA,CAACA,SAASA,CAACA,CAACA,CAACA;IAC1DA,CAACA,EAxHWD,EAAEA,GAAFA,OAAEA,KAAFA,OAAEA,QAwHbA;AAADA,CAACA,EAxHM,IAAI,KAAJ,IAAI,QAwHV","file":"BringThePopcorn/controls/playlist/playlist.js","sourcesContent":["module BtPo.UI {\r\n    export class PlayListControl {\r\n        public element: HTMLElement;\r\n        eventTracker: WinJSContrib.UI.EventTracker;\r\n        itemTemplate: WinJS.Binding.Template;\r\n        currentId: number;\r\n        throttle: number;\r\n        _items: any[];\r\n        lastrefresh: Date;\r\n        \r\n        constructor(element?, options?) {\r\n            this.element = element || document.createElement('DIV');\r\n            this.eventTracker = new WinJSContrib.UI.EventTracker();\r\n            options = options || {};\r\n            this.element.winControl = this;\r\n            this.element.classList.add('playlistcontrol');\r\n            this.element.classList.add('win-disposable');\r\n            this.element.classList.add('mcn-layout-ctrl');\r\n            WinJS.UI.setOptions(this, options);\r\n            this.itemTemplate = new WinJS.Binding.Template(null, { href: '/templates/playlistitem.html', extractChild: true });\r\n\r\n            this.eventTracker.addBinding(Kodi.NowPlaying.current, \"id\", () => {\r\n                this.refresh();\r\n            });\r\n\r\n            this.eventTracker.addBinding(Kodi.NowPlaying.current, \"expanded\", () => {\r\n                this.refresh(true);\r\n                if (!Kodi.NowPlaying.current.expanded) {\r\n                    this.element.innerHTML = \"\";\r\n                }\r\n            });\r\n\r\n            this.eventTracker.addEvent(WinJS.Application, \"Playlist.OnAdd\", () => {\r\n                clearTimeout(this.throttle);\r\n                this.throttle = setTimeout(() => {\r\n                    var delta = (<any>new Date()) - <any>this.lastrefresh;\r\n                    if (delta > 1000) {\r\n                        this.refresh();\r\n                    }\r\n                }, 700);\r\n                \r\n            });\r\n\r\n            \r\n        }\r\n\r\n        get items() {\r\n            return this._items;\r\n        }\r\n\r\n        set items(val) {\r\n            this._items = val;\r\n            \r\n        }\r\n\r\n        refresh(animate? : boolean) {\r\n            if (Kodi.NowPlaying.current.expanded) {\r\n                Kodi.API.PlayList.getItems(Kodi.NowPlaying.current.playlistid).then((playlist) => {\r\n                    this.items = playlist.items;\r\n                    this.renderItems(animate);\r\n                    this.lastrefresh = new Date();\r\n                });\r\n            }\r\n        }\r\n\r\n        renderItems(animate: boolean) {\r\n            //var container = document.createDocumentFragment();\r\n            var p = [];\r\n            var elts = [];\r\n\r\n            this.element.innerHTML = \"\";\r\n\r\n            if (this.items) {\r\n                this.items.forEach((i, index) => {\r\n                    p.push(this.itemTemplate.render(i).then((rendered) => {\r\n                        elts.push(rendered);\r\n                        if (animate) {\r\n                            rendered.style.opacity = \"0\";\r\n                        }\r\n                        this.element.appendChild(rendered);\r\n                        if (i.id == Kodi.NowPlaying.current.id) {\r\n                            rendered.classList.add(\"current\");\r\n                        }\r\n\r\n                        var btnplay = rendered.querySelector(\".btnplay\");\r\n                        var btnremove = rendered.querySelector(\".btnremove\");\r\n\r\n                        WinJSContrib.UI.tap(btnplay, () => {\r\n                            return Kodi.API.Player.moveTo(Kodi.NowPlaying.current.playerid, index).then(() => {\r\n                                this.refresh();\r\n                            });\r\n                        });\r\n\r\n                        WinJSContrib.UI.tap(btnremove, () => {\r\n                            return Kodi.API.PlayList.removeAt(Kodi.NowPlaying.current.playlistid, index).then(() => {\r\n                                return WinJSContrib.UI.removeElementAnimation(rendered).then(() => {\r\n                                    //this.refresh();\r\n                                });\r\n                            });\r\n                        });\r\n                    }));\r\n                });\r\n\r\n                WinJS.Promise.join(p).then(() => {\r\n                    if (animate) {\r\n                        WinJS.UI.Animation.enterPage(elts);\r\n                    }\r\n                    //    this.element.innerHTML = \"\";\r\n                    //    this.element.appendChild(container);\r\n                });\r\n            }\r\n        }\r\n\r\n        dispose() {\r\n            this.eventTracker.dispose();\r\n        }\r\n    }\r\n\r\n    export var PlayList = WinJS.Class.mix(WinJS.Utilities.markSupportedForProcessing(PlayListControl), WinJS.Utilities.eventMixin,\r\n        WinJS.Utilities.createEventProperties(\"myevent\"));\r\n}"],"sourceRoot":" "}